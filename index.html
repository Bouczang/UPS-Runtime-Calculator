<!DOCTYPE html>
<html>
<head>
    <title>UPS Runtime Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background: #f5f5f5;
        }
        #ups-calculator {
            max-width: 650px;
            margin: 0 auto;
            padding: 25px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        label {
            display: inline-block;
            width: 280px;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input, select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 150px;
            margin-bottom: 10px;
        }
        button {
            display: block;
            margin: 25px auto;
            padding: 12px 25px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover {
            background: #2980b9;
        }
        #result {
            margin-top: 25px;
            padding: 20px;
            background: #eaf7ff;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        .config-section {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .warning {
            color: #e74c3c;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="ups-calculator">
        <h2>UPS Runtime Calculator</h2>
        
        <div class="config-section">
            <h3>Battery Configuration</h3>
            <div>
                <label for="battery-capacity">Single Battery Capacity (Ah):</label>
                <input type="number" id="battery-capacity" step="0.1" placeholder="e.g., 100" value="100">
            </div>
            <div>
                <label for="battery-voltage">Single Battery Voltage (V):</label>
                <input type="number" id="battery-voltage" value="12">
            </div>
            <div>
                <label for="battery-count">Total Number of Batteries:</label>
                <input type="number" id="battery-count" value="4">
            </div>
            <div>
                <label for="arrangement">Battery Arrangement:</label>
                <select id="arrangement">
                    <option value="parallel">Parallel (↑ Capacity, Voltage same)</option>
                    <option value="series">Series (↑ Voltage, Capacity same)</option>
                    <option value="custom">Custom (Series-Parallel)</option>
                </select>
            </div>
            <div id="custom-config" style="display: none;">
                <label for="series-count">Batteries in Series per String:</label>
                <input type="number" id="series-count" value="2" min="1">
                <label for="parallel-strings">Parallel Strings:</label>
                <input type="number" id="parallel-strings" value="2" min="1">
            </div>
        </div>
 
        <div class="config-section">
            <h3>Load Configuration</h3>
            <div>
                <label for="load-power">Load Power (W):</label>
                <input type="number" id="load-power" placeholder="e.g., 500" value="500">
            </div>
            <div>
                <label for="efficiency">Efficiency Factor (0.8-1.0):</label>
                <input type="number" id="efficiency" value="0.9" step="0.01" min="0.8" max="1.0">
            </div>
        </div>
 
        <div class="config-section">
            <h3>Cable Voltage Drop</h3>
            <div>
                <label for="cable-length">Cable Length (meters):</label>
                <input type="number" id="cable-length" value="5" min="0">
            </div>
            <div>
                <label for="cable-size">Cable Size (mm²):</label>
                <select id="cable-size">
                    <option value="0.0032">16 mm² (0.0032 Ω/m)</option>
                    <option value="0.0050" selected>10 mm² (0.0050 Ω/m)</option>
                    <option value="0.0080">6 mm² (0.0080 Ω/m)</option>
                    <option value="custom">Custom Resistance...</option>
                </select>
            </div>
            <div id="custom-resistance" style="display:none;">
                <label for="cable-resistance">Custom Resistance (Ω/m):</label>
                <input type="number" id="cable-resistance" step="0.0001" min="0">
            </div>
        </div>
 
        <button id="calculate-btn">Calculate Runtime</button>
        <div id="result"></div>
    </div>
    
    <script>
        // Helper function to format runtime
        function formatRuntime(totalMinutes) {
            totalMinutes = Math.round(totalMinutes);
            const days = Math.floor(totalMinutes / 1440);
            const hours = Math.floor((totalMinutes % 1440) / 60);
            const minutes = totalMinutes % 60;
            
            let parts = [];
            if (days > 0) parts.push(`${days} day${days !== 1 ? 's' : ''}`);
            if (hours > 0) parts.push(`${hours} hour${hours !== 1 ? 's' : ''}`);
            if (minutes > 0 || parts.length === 0) parts.push(`${minutes} minute${minutes !== 1 ? 's' : ''}`);
            
            return parts.join(' ');
        }
 
        // Toggle custom battery config
        document.getElementById('arrangement').addEventListener('change', function() {
            document.getElementById('custom-config').style.display =
                this.value === 'custom' ? 'block' : 'none';
        });
 
        // Toggle custom cable resistance
        document.getElementById('cable-size').addEventListener('change', function() {
            document.getElementById('custom-resistance').style.display =
                this.value === 'custom' ? 'block' : 'none';
        });
 
        // Calculate runtime
        document.getElementById('calculate-btn').addEventListener('click', calculateRuntime);
 
        function calculateRuntime() {
            // [Keep all your existing input collection and validation code]
 
            // Calculate runtime (with derating if voltage drop >5%)
            const totalWh = totalV * totalAh * efficiency;
            let runtimeHours = totalWh / load;
            const runtimeMinutes = runtimeHours * 60;
            
            if (voltageDrop > 0.05 * totalV) {
                runtimeHours *= 0.95; // 5% penalty for high voltage drop
            }
 
            // Display results
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <h3>Battery Bank Configuration</h3>
                <p>Total Voltage: <strong>${totalV.toFixed(2)}V</strong></p>
                <p>Total Capacity: <strong>${totalAh.toFixed(2)}Ah</strong></p>
                <p>Total Energy: <strong>${(totalWh).toFixed(0)}Wh</strong></p>
 
                <h3>Cable Voltage Drop</h3>
                <p>Current: <strong>${current.toFixed(2)}A</strong></p>
                <p>Voltage Drop: <strong>${voltageDrop.toFixed(2)}V</strong> (${((voltageDrop/totalV)*100).toFixed(1)}%)</p>
                <p>Effective Voltage: <strong>${effectiveVoltage.toFixed(2)}V</strong></p>
                ${voltageDrop > 0.05 * totalV ? "<p class='warning'>Warning: High voltage drop! Consider thicker/shorter cables.</p>" : ""}
 
                <h3>Estimated Runtime</h3>
                <p><strong>${formatRuntime(runtimeMinutes)}</strong></p>
                <p>(${runtimeHours.toFixed(2)} hours / ${Math.round(runtimeMinutes)} minutes)</p>
            `;
        }
    </script>
</body>
</html>
